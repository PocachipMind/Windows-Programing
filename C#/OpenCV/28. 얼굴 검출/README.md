# 얼굴 검출
얼굴 검출은 영상이나 이미지에서 얼굴을 찾기 위해서 사용합니다.

얼굴 검출은 영상처리의 한 분야로 영상에서 얼굴이 존재하는 위치를 알려줍니다.

이미 트레이닝된 정보를 활용해 구현하며 간단하게 얼굴 검출 알고리즘을 구현할 수 있습니다.

XML 파일로 구성되어 얼굴, 눈, 미소 등에 대하여 훈련된 분류기가 존재합니다. 이를 활용하여 얼굴을 검출하게 됩니다.

200 여개의 트리 정보가 포함되어 있어 쉽게 검출할 수 있습니다.

이 xml 파일을 이미지가 저장된 경로와 동일한 경로에 저장하여 사용합니다.

- haarcascade_frontalface_alt.xml 파일 사용
- 200 여개의 tree 정보 포함

## 얼굴 검출 알고리즘 - 하르(haar) 분류기
- 위치, 모양, 크기에 따라 다양한 형태로 구성
- 특징 값은 [흰색 영역 화소 값의 합]과 [검은색 직사각형 영역 화소 값의 합]의 차로 정의
- 얼굴만이 가지는 단순한 특징들을 조합하여 객체를 찾아내는 방법
- 얼굴 검출은 얼굴 형태의 패턴을 찾아 얼굴을 검출하는 알고리즘
- 얼굴 검출은 얼굴 인식과 다른 알고리즘입니다. 얼굴 인식은 사용자의 얼굴을 알아보고 타인을 구별하는 알고리즘이지만 얼굴 검출은 얼굴의 특징을 파악하여 얼굴이 존재하는 위치를 알려줍니다.
- 즉 얼굴 검출은 얼굴 형태의 패턴을 찾아 얼굴을 검출해주는 알고리즘입니다.

## 얼굴 검출
얼굴 검출 알고리즘 또한 검출용 이미지를 생성하셔야합니다.

단일 채널 이미지를 사용하며 그레이 스케일이 적용된 검출용 이미지를 생성해야 합니다. 이후 히스토그램 평활화를 통하여 히스토그램의 높이를 같게 만들어 그레이스케일 이미지에서 대비를 일정하게 맞춥니다.

평활화를 적용할 경우 이목구비에 대한 명암이 두드러지게 되어 얼굴만이 가지는 특징이 좀 더 부각됩니다.

1) 검출용 단일 채널 이미지 생성
2) 히스토그램 평활화를 통하여 이목구비를 뚜렷하게 변경


## 하루 함수 사용 인수

1) cascade : xml 파일이 저장된 HaarClassifierCascade ( 경로 )

캐스케이드는 xml 파일에 경로가 포함된 변수를 의미합니다. 이미지나 동영상을 IPL이미지 변수에 담듯이 XML 파일의 경로가 담겨있는 cascade 변수를 생성하셔야합니다.

2) ScaleFactor : 이미지 크기가 감소되는 양

이를 초과하는 값을 사용해야하며 너무 크거나 너무 작을 경우 얼굴이 아닌 다른 옷이나 사물이 검출될 수 있습니다.

3) minNeighbors : 인접한 얼굴의 수

이 값은 인접한 얼굴의 수를 제한합니다. 1보다 이상의 값을 사용하는 것이 좋습니다. 만약 0으로 사용할 경우 같은 얼굴 안에서 얼굴이 중복해서 찾아지게 됩니다.

2번 ScaleFactor, 3번 minNeighbors는 상수 값을 사용합니다.

하루 분류기는 특징을 조합하여 찾기 때문에 얼굴이 아닌 사물이나 같은 얼굴이 중복해서 검출됩니다.

4) HaarDetectionType.* : 작동 모드
   - Zero : 최적화 수행 안함
   - DoCannyPruning : Canny Edge detector를 사용, 가장자리가 너무 적거나 많은 경우 검출하지 않음
   - ScaleImage : 다운스케일만 적용하여 cascade 수행. 확대 축소를 하지않고 다운스케일만을 통해서 캐스케이드를 수행.
   - FindBiggestObject : 가장 큰 얼굴만 검출. 이미지에서 가장 큰 얼굴 한 명만 검출
   - DoRoughSearch : 얼굴을 충분히 검출했을 경우, 작은 크기 얼굴은 검출 하지 않음

5) MinSize : 검출할 얼굴의 최소 크기를 설정
6) MaxSize : 검출할 얼굴의 최대 크기를 설정

5,6 인수에 값을 0으로 설정할 경우 제한 크기를 설정하지 않아 모든 얼굴을 찾습니다.


## 얼굴 위치 계산

![image](https://github.com/user-attachments/assets/9cbf5cc0-a0ad-467e-9736-7501f3a7ecec)

검출을 통하여 얻어낸 데이터로 얼굴의 정확한 위치를 계산하는 방법을 알아보도록 하겠습니다.

얼굴 검출을 통하여 얻어낸 데이터는 사각형 형태의 CVRect형식으로 반환됩니다.

좌측 상단 모서리가 기준점이며 이 점을 토대로 다시 계산식을 만들어야 합니다. 

중심점 X는 검출된 얼굴의 위치까지 이동해야하므로 RX의 값을 더합니다. 이후 중심점의 위치로 이동하기 위해서 너비의 절반만큼 더합니다.

중심점 Y도 동일합니다. RY에서 높이의 절반만큼 더한 값으로 사용합니다.

반지름의 경우 너비와 높이의 더한 값에 4분의 1로 나눕니다. 여기서 너비나 높이의 절반으로 반지름을 사용하지 않는 이유는 너비와 높이가 같은 값이 아닐 수 있기 때문입니다.

그러므로 두 값을 더한 값에 1/4를 반지름으로 사용합니다. 이제 검출된 얼굴의 중심점과 반지름을 계산하였으므로 유의미한 데이터를 얻어냈습니다.
